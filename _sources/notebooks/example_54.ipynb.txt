{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Simple room temperature (ex. 54)\n",
    "\n",
    "## Overview\n",
    "\n",
    "The relevant section of the top-level YAML looks like this:\n",
    "\n",
    "```yaml\n",
    "components:\n",
    "  # ... other stuff ...\n",
    "\n",
    "  # NOTE: Constructing a simple \"degree celsius\" storage, ranging from 20 to 23 degrees.\n",
    "  house:\n",
    "    type: Node\n",
    "    carrier: heat_degree_celsius\n",
    "    has_state: true\n",
    "    state_lb: 20\n",
    "    state_ub: 23\n",
    "\n",
    "  heatpump:\n",
    "    type: Unit\n",
    "    inputs: {electricity: grid}\n",
    "    outputs: {heat_degree_celsius: house}\n",
    "    conversion: 1 electricity -> cop@data * <degc_per_kWh> heat_degree_celsius\n",
    "    capacity: 5 in:electricity\n",
    "  \n",
    "  # NOTE: Modeling this using `node_from` means it models the passive cooling of the house; negative values in\n",
    "  #       `demand@data` therefore relate to passive heating (e.g., during summer times).\n",
    "  passive_change:\n",
    "    type: Profile\n",
    "    carrier: heat_degree_celsius\n",
    "    node_from: house\n",
    "    value: demand@data\n",
    "```\n",
    "\n",
    "This is a simple model of a house with a heat pump that can heat the house. The heat pump has a coefficient of performance (COP) that is pre-calculated based on outside temperature. The house has a temperature that is bounded between 20 and 23 degrees Celsius. The house assively changes temperature based on the `passive_change` profile. Using the `degc_per_kWh` parameter we translate heat energy output from the heat pump to temperature change in the house."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Running the example\n",
    "\n",
    "First, import `iesopt`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "tags": [
     "remove-stdout",
     "remove-stderr"
    ]
   },
   "outputs": [],
   "source": [
    "import iesopt"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Then, create a local copy of the IESopt example."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "INFO:iesopt:Data folder for examples already exists; NOT copying ANY contents\n",
      "INFO:iesopt:Creating example ('54_simple_roomtemperature') at: 'opt/54_simple_roomtemperature.iesopt.yaml'\n",
      "INFO:iesopt:Set write permissions for example ('opt/54_simple_roomtemperature.iesopt.yaml'), and data folder ('opt/files')\n"
     ]
    }
   ],
   "source": [
    "config = iesopt.make_example(\"54_simple_roomtemperature\", \"opt\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Finally, run the model and observe some results."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>snapshot</th>\n",
       "      <th>component</th>\n",
       "      <th>fieldtype</th>\n",
       "      <th>field</th>\n",
       "      <th>value</th>\n",
       "      <th>mode</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>169</th>\n",
       "      <td>t1</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.996</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>170</th>\n",
       "      <td>t2</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.396</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>171</th>\n",
       "      <td>t3</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.392</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>172</th>\n",
       "      <td>t4</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.800</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>173</th>\n",
       "      <td>t5</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.200</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174</th>\n",
       "      <td>t6</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.600</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>175</th>\n",
       "      <td>t7</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>176</th>\n",
       "      <td>t8</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>177</th>\n",
       "      <td>t9</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>178</th>\n",
       "      <td>t10</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.100</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>179</th>\n",
       "      <td>t11</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>180</th>\n",
       "      <td>t12</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.404</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>181</th>\n",
       "      <td>t13</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.504</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>182</th>\n",
       "      <td>t14</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.504</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>183</th>\n",
       "      <td>t15</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>23.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184</th>\n",
       "      <td>t16</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>23.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>185</th>\n",
       "      <td>t17</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>22.700</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>186</th>\n",
       "      <td>t18</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>22.400</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>187</th>\n",
       "      <td>t19</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>23.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>188</th>\n",
       "      <td>t20</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>22.400</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>189</th>\n",
       "      <td>t21</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.800</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>190</th>\n",
       "      <td>t22</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>21.200</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>191</th>\n",
       "      <td>t23</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.600</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>192</th>\n",
       "      <td>t24</td>\n",
       "      <td>house</td>\n",
       "      <td>var</td>\n",
       "      <td>state</td>\n",
       "      <td>20.000</td>\n",
       "      <td>primal</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    snapshot component fieldtype  field   value    mode\n",
       "169       t1     house       var  state  20.996  primal\n",
       "170       t2     house       var  state  20.396  primal\n",
       "171       t3     house       var  state  21.392  primal\n",
       "172       t4     house       var  state  21.800  primal\n",
       "173       t5     house       var  state  21.200  primal\n",
       "174       t6     house       var  state  20.600  primal\n",
       "175       t7     house       var  state  20.000  primal\n",
       "176       t8     house       var  state  20.000  primal\n",
       "177       t9     house       var  state  20.000  primal\n",
       "178      t10     house       var  state  20.100  primal\n",
       "179      t11     house       var  state  20.000  primal\n",
       "180      t12     house       var  state  21.404  primal\n",
       "181      t13     house       var  state  21.504  primal\n",
       "182      t14     house       var  state  21.504  primal\n",
       "183      t15     house       var  state  23.000  primal\n",
       "184      t16     house       var  state  23.000  primal\n",
       "185      t17     house       var  state  22.700  primal\n",
       "186      t18     house       var  state  22.400  primal\n",
       "187      t19     house       var  state  23.000  primal\n",
       "188      t20     house       var  state  22.400  primal\n",
       "189      t21     house       var  state  21.800  primal\n",
       "190      t22     house       var  state  21.200  primal\n",
       "191      t23     house       var  state  20.600  primal\n",
       "192      t24     house       var  state  20.000  primal"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "model = iesopt.run(config, config={\"general.verbosity.core\": \"error\"})\n",
    "\n",
    "model.results.to_pandas().query(\n",
    "    \"component == 'house' and field == 'state' and mode == 'primal'\"\n",
    ")"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": ".venv",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
